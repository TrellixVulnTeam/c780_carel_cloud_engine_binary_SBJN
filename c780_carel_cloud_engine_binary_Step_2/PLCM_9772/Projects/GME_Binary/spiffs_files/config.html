<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="style.css" />
</head>
<body>
  <div class="imgcontainer">
    <img src="fav.ico" alt="Avatar" class="avatar">
  </div>
    
  <h1 class="imgcontainer">Welcome to CAREL!</h1>
    
  <div class="container">
    <div>
      <form action="upload/" method="POST" >
        <div class="">
          <table style="width:350px;">
            <tr>
              <td><label for="gateway_mode" ><b>Wifi Mode</b></label></td>
              <td>
                <select name="gateway_mode" class="select_c" id="gateway_m">
                  <option value="apsta_mode" onclick="wifi_mode()">AP/STA mode</option>
                  <option value="ap_mode" onclick="wifi_mode()">AP mode only</option>
                </select> 
              </td>
            </tr>
          </table>
            <table style="width:350px;" >
            <tr><div><h2>Access Point Option</h2></div> </tr> 
              <tr>
                <td><label for="ap_ssid"><b>SSID</b></label></td>
                <td><input type="text" value="" name="ap_ssid" required></td>
              </tr>
              <tr>
                 <td><label for="ap_ssid_hidden"></label></td>
                <td><input id="ap_ssid_hidden" type="checkbox" value="" name="ap_ssid_hidden">  Hide SSID</td>
              </tr>
              <tr>
                <td><label for="ap_pswd"><b>Password</b></label></td>
                <td><input type="password" placeholder="" value="" name="ap_pswd" required><br>
                  <input type="checkbox" onclick="apshowpass()">Show Password</td>
              </tr>
              <tr>
                <td><label for="ap_ip"><b>IP</b></label></td>
                <td><input type="text" value="" name="ap_ip" required></td>
              </tr>
              <tr>
                <td><label for="ap_dhcp_mode" id="ap_dhcp_m"><b>DHCP</b></label></td>
                <td>
                  <ul style=" padding-left: 0px;">
                    <li style = "display:inline;">
                      <input id="ap_dhcp_mode_on" type="radio" value="on" name="ap_dhcp_mode" checked="checked" onclick="ap_dhcp()" required>
                      <label><b>ON</b></label>
                    </li>
                    <li style = "display:inline; padding-left: 20px;">
                      <input id="ap_dhcp_mode_off" type="radio" value="off" name="ap_dhcp_mode" onclick="ap_dhcp()" required>
                      <label><b>OFF</b></label>
                    </li>
                  </ul>
                </td>
              </tr>
              <tr id="ap_dhcp" style = "display:table-row;">
                <td id="ap_dhcp"><label for="ap_dhcp_ip"><b>DHCP IP</b></label></td>
                <td id="ap_dhcp"><input type="text" value="" name="ap_dhcp_ip" required></td>
              </tr>
          </table>
            
          <div id="sta_mode_only">
            <table style="width: 350px">
              <tr><h2>Station mode Option</h2></tr>

              <tr>
                <td><label for="sta_ssid"><b>SSID</b></label></td>
                <td><input type="text" value="" name="sta_ssid" id="sta_ssid_id" ></td>
              </tr>

              <tr>
                <td><label for="sta_encryption"><b>Encryption</b></label></td>
                <td>
                  <select name="sta_encryption" class="select_c">
                    <option value="">WPA/WAP2</option>
                  </select>
                </td>
              </tr>

              <tr>
                <td><label for="sta_pswd"><b>Password</b></label></td>
                <td><input type="password" value="" name="sta_pswd"><br>
                  <input type="checkbox" onclick="stashowpass()">Show Password</td>
              </tr>
              
              <tr>
                <td><label for="sta_dhcp_mode"><b>DHCP</b></label></td>
                <td>
                  <ul style=" padding-left: 0px;">
                    <li selected="selected" style = "display:inline;">
                      <input id="sta_dhcp_mode_on"  type="radio" value="on" name="sta_dhcp_mode" checked="checked" onclick="sta_dhcp()">
                      <label for="sta_dhcp_mode"><b>ON</b></label>
                    </li>
                    <li style = "display:inline; padding-left: 20px;">
                        <input id="sta_dhcp_mode_off" type="radio" value="off" name="sta_dhcp_mode" onclick="sta_dhcp()">
                        <label for="sta_dhcp_mode"><b>OFF</b></label>
                      </li>
                  </ul>
                </td>
              </tr>
              
                <tr id="sta_dhcp">
                  <td><label for="sta_static_ip"><b>Static IP</b></label></td>
                  <td><input type="text" value="" name="sta_static_ip" ></td>
                </tr>

                <tr id="sta_dhcp" >
                  <td><label for="sta_netmask"><b>Netmask</b></label></td>
                  <td><input type="text" value="" name="sta_netmask" ></td>
                </tr>

                <tr id="sta_dhcp" >
                  <td><label for="sta_ip"><b>Gateway</b></label></td>
                  <td><input type="text" value="" name="sta_gateway" ></td>
                </tr>

                <tr id="sta_dhcp">
                  <td><label for="sta_ip"><b>Primary DNS</b></label></td>
                  <td><input type="text" value="" name="sta_pri_dns" ></td>
                </tr>

                <tr id="sta_dhcp">
                  <td><label for="sta_ip"><b>Secondary DNS</b></label></td>
                  <td><input type="text" value="" name="sta_scnd_dns" ></td>
                </tr>
            </table> 
          </div>
          <div id="ntp_server">
            <table style="width: 350px">
              <tr><h2>NTP Server</h2></tr>

              <tr>
                <td><label for="ntp_addr"><b>Server Address</b></label></td>
                <td><input type="text" value="" name="ntp_addr" ></td>
              </tr>

              <tr>
                <td><label for="ntp_port"><b>Server Port</b></label></td>
                <td><input type="text" value="" name="ntp_port" ></td>
              </tr>

            </table>
          </div>
          <div id="MQTT">
            <table style="width: 350px">
              <tr><h2>MQTT</h2></tr>

              <tr>
                <td><label for="mqtt_addr"><b>Server Address</b></label></td>
                <td><input type="text" value="" name="mqtt_addr" ></td>
              </tr>

              <tr>
                <td><label for="mqtt_port"><b>Server Port</b></label></td>
                <td><input type="text" value="" name="mqtt_port" ></td>
              </tr>

            </table>
          </div>
        </div>
        <label for="end"></label><input type="text" name="end" value="end" style="display: none;">
        <button type="submit" onclick="myFunction()">Submit</button>
      </form>
    </div>
  </div>

  <script>
wifi_mode(); 

var configjs;
    const Http = new XMLHttpRequest();
    const url = 'config.json';
    Http.open("GET",url);
    Http.send();
    console.log("Hello01");

    Http.onreadystatechange=function(){
        if(this.readyState == 4 && this.status == 200){
            configjs = JSON.parse(Http.responseText);
            console.log(configjs);
            document.getElementsByName('ap_ssid')[0].value = configjs.ap_ssid;
            document.getElementById('ap_ssid_hidden').checked = configjs.ap_ssid_hidden;
            document.getElementsByName('ap_pswd')[0].value = configjs.ap_pswd;
            document.getElementsByName('ap_ip')[0].value = configjs.ap_ip;

            if(configjs.ap_dhcp_mode == true){
              document.getElementById('ap_dhcp_mode_on').checked = true;
              document.getElementById('ap_dhcp_mode_off').checked = false;
            }else{
              document.getElementById('ap_dhcp_mode_on').checked = false;
              document.getElementById('ap_dhcp_mode_off').checked = true;
            }

            document.getElementsByName('ap_dhcp_ip')[0].value = configjs.ap_dhcp_ip;

            document.getElementsByName('sta_ssid')[0].value = configjs.sta_ssid;
            document.getElementsByName('sta_pswd')[0].value = configjs.sta_pswd;
            document.getElementsByName('ap_pswd')[0].value = configjs.ap_pswd;

            if(configjs.sta_dhcp_mode == true){
              document.getElementById('sta_dhcp_mode_on').checked = true;
              document.getElementById('sta_dhcp_mode_off').checked = false;
            }else{
              document.getElementById('sta_dhcp_mode_on').checked = false;
              document.getElementById('sta_dhcp_mode_off').checked = true;
            }

            document.getElementsByName('sta_static_ip')[0].value = configjs.sta_static_ip;
            document.getElementsByName('sta_netmask')[0].value = configjs.sta_netmask;
            document.getElementsByName('sta_gateway')[0].value = configjs.sta_gateway;
            document.getElementsByName('sta_pri_dns')[0].value = configjs.sta_pri_dns;
            document.getElementsByName('sta_scnd_dns')[0].value = configjs.sta_scnd_dns;
            document.getElementsByName('ntp_addr')[0].value = configjs.ntp_addr;
            document.getElementsByName('ntp_port')[0].value = configjs.ntp_port;
            document.getElementsByName('mqtt_addr')[0].value = configjs.mqtt_addr;
            document.getElementsByName('mqtt_port')[0].value = configjs.mqtt_port;
        }
    }
      function wifi_mode() {
        var x = document.getElementById("gateway_m");
        var y = document.getElementById("sta_mode_only");

          if (x.value == "ap_mode") {
            y.style.display = "none";
            document.getElementsByName("sta_ssid")[0].required = false;
            document.getElementsByName("sta_pswd")[0].required = false;
          }
          else if(x.value == "apsta_mode"){
            y.style.display = "block";
            document.getElementsByName("sta_ssid")[0].required = true;
            document.getElementsByName("sta_pswd")[0].required = true;
            
          }
      }

      function stashowpass(){
        var x = document.getElementsByName("sta_pswd")[0];
        if (x.type === "password") {
          x.type = "text";
        } else {
          x.type = "password";
        }
      }

      function apshowpass(){
        var x = document.getElementsByName("ap_pswd")[0];
        if (x.type === "password") {
          x.type = "text";
        } else {
          x.type = "password";
        }
      }


  </script>
</body>
</html>
